Confluence連携を対話形式で設定します。

## 概要

プロジェクト用のConfluenceスペース作成と標準フォルダ構成を設定します。

## 前提条件

- Confluence MCPが設定されていること
- または、手動作成用のテンプレートを出力

## 質問フロー

### 質問1: 設定方法
1. MCP経由で自動作成（Confluence MCP必要）
2. 手動作成用テンプレートを出力

### 質問2: スペース情報
- スペースキー（例: CUSTPORTAL）
- スペース名（例: Customer Portal）
- 説明

### 質問3: 作成するフォルダを選択（チェック形式・複数選択可）

以下の形式でユーザーに提示し、チェックで選択してもらう：

```
【質問】Confluenceに作成するフォルダを選択してください（複数選択可）

[x] 01_プロジェクト概要（プロジェクト概要、体制図、スケジュール）
[x] 02_要件定義（機能要件、非機能要件、画面一覧）
[x] 03_設計（アーキテクチャ、DB、API、画面）
[x] 04_開発（環境構築、コーディング規約、開発ガイド）
[ ] 05_テスト（テスト計画、ケース、結果）
[ ] 06_運用（運用手順、障害対応、監視）
[x] 07_議事録
[ ] 08_その他（参考資料）

※ [x] = 選択済み（デフォルト）
※ 番号を指定して追加/削除してください（例: +5, -3）
※ 「all」で全選択、「none」で全解除
```

#### デフォルト選択

プロジェクト種別に応じてデフォルトを変更：

| 種別 | デフォルト選択 |
|------|--------------|
| Webアプリ/API | 01, 02, 03, 04, 05, 06, 07 |
| バッチ/ツール | 01, 02, 03, 04, 07 |
| PoC | 01, 04, 07 |

### 質問4: 初期ページ作成
1. すべての初期ページを作成（テンプレート内容で作成）
2. フォルダのみ作成（ページは空）
0. スキップ

### 質問5: 確認

```
以下の内容でConfluenceスペースを作成します：

スペースキー: CUSTPORTAL
スペース名: Customer Portal

作成するフォルダ:
  ✓ 01_プロジェクト概要（3ページ）
  ✓ 02_要件定義（3ページ）
  ✓ 03_設計（4ページ）
  ✓ 04_開発（3ページ）
  ✓ 07_議事録（1ページ）

合計: 5フォルダ、14ページ

続行しますか？ (yes / no / edit)
```

## フォルダ詳細

### 01_プロジェクト概要
- プロジェクト概要
- 体制図
- スケジュール

### 02_要件定義
- 機能要件
- 非機能要件
- 画面一覧

### 03_設計
- アーキテクチャ設計
- DB設計
- API設計
- 画面設計

### 04_開発
- 環境構築手順
- コーディング規約
- 開発ガイド

### 05_テスト
- テスト計画
- テストケース
- テスト結果

### 06_運用
- 運用手順書
- 障害対応手順
- 監視設定

### 07_議事録
- 議事録テンプレート

### 08_その他
- 参考資料

## テンプレート参照先

各ページのテンプレートは以下を参照：

```
.claude/docs/confluence-templates/
├── 01_プロジェクト概要/
├── 02_要件定義/
├── 03_設計/
├── 04_開発/
├── 05_テスト/
├── 06_運用/
├── 07_議事録/
└── 08_その他/
```

## Markdown → Confluence変換

テンプレートファイル（Markdown）をConfluenceページとして作成する際、自動的にConfluence Storage Format（XHTML）に変換する。

### 変換ルール

| Markdown | Confluence |
|----------|------------|
| `# 見出し1` | `<h1>見出し1</h1>` |
| `## 見出し2` | `<h2>見出し2</h2>` |
| `**太字**` | `<strong>太字</strong>` |
| `- リスト` | `<ul><li>リスト</li></ul>` |
| `1. 番号リスト` | `<ol><li>番号リスト</li></ol>` |
| `\| 表 \|` | `<table>...</table>` |
| `` `コード` `` | `<code>コード</code>` |
| ```` ```コードブロック``` ```` | `<ac:structured-macro ac:name="code">...</ac:structured-macro>` |
| `[リンク](url)` | `<a href="url">リンク</a>` |
| `---` | `<hr />` |

### 変換例

**入力（Markdown）**:
```markdown
# 議事録

## 会議情報

| 項目 | 内容 |
|------|------|
| 日時 | 2024-01-15 10:00 |
| 場所 | 会議室A |

## 参加者

- 山田太郎
- 佐藤花子

## 決定事項

1. **機能Aの実装方針**を決定
2. 次回会議は来週月曜
```

**出力（Confluence Storage Format）**:
```xml
<h1>議事録</h1>
<h2>会議情報</h2>
<table>
  <tbody>
    <tr>
      <th>項目</th>
      <th>内容</th>
    </tr>
    <tr>
      <td>日時</td>
      <td>2024-01-15 10:00</td>
    </tr>
    <tr>
      <td>場所</td>
      <td>会議室A</td>
    </tr>
  </tbody>
</table>
<h2>参加者</h2>
<ul>
  <li>山田太郎</li>
  <li>佐藤花子</li>
</ul>
<h2>決定事項</h2>
<ol>
  <li><strong>機能Aの実装方針</strong>を決定</li>
  <li>次回会議は来週月曜</li>
</ol>
```

### 処理フロー

```
1. テンプレートファイル（.md）を読み込み
2. Markdown → Confluence Storage Format に変換
3. Confluence API でページ作成
4. ページとして表示される（リッチテキスト形式）
```

## 手動作成用出力

MCP未設定の場合、以下を出力：

1. スペース作成手順
2. 選択されたフォルダ構成一覧
3. 選択されたページのテンプレート（Confluence形式に変換済み）
   - そのままConfluenceエディタに貼り付け可能

## 設定の記録

完了後、`.claude/project-config.yml` の `confluence` セクションを更新：

```yaml
confluence:
  status: completed
  completed_at: "2024-01-15T10:00:00Z"
  space_key: "CUSTPORTAL"
  space_name: "Customer Portal"
  folders:
    - "01_プロジェクト概要"
    - "02_要件定義"
    - "03_設計"
    - "04_開発"
    - "07_議事録"
```

---

## 開始

それでは、Confluence連携の設定を開始します。
まず、設定方法を選択してください。

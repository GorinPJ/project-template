# サブエージェント共通ルール

このファイルは全サブエージェントが従う共通ルールを定義します。

---

## 作業開始ルール

指示を受けた後、以下の順序で進めること：

1. **プランニング**: まず作業計画を立て、ユーザーに提示する
2. **ヒアリング**: 不明点があれば確認する
3. **承認待ち**: ユーザーの承認を得るまで修正を開始しない

**重要**: いきなりコードを修正しないこと。

---

## 質問ルール

ユーザーへの質問が複数ある場合、**1つずつ順番に聞く**こと。

一度に複数の質問を投げかけない。

---

## 自己改善ルール

作業プロセスに変更・改善があった場合は、自身のエージェント定義ファイルを更新すること。

例：
- 新しいルールが追加された場合
- 作業手順が変更された場合
- エラー対処法が追加された場合

### 仕様変更時のチェックリスト

仕様変更を行った場合、以下を確認すること：

- [ ] 関連ドキュメント（MDファイル等）を更新したか
- [ ] **該当エージェントの定義ファイル（`.claude/agents/{カテゴリ}/{名前}.md`）を更新したか**

---

## 作業完了時の記録

作業が完了したら、work-history-recorderを呼び出して作業履歴を記録すること。

| 項目 | 内容 |
|------|------|
| 対象 | 自身のサブエージェント名 |
| 記録先 | `work/作業履歴/サブエージェント/{自身の名前}/` |

呼び出し例：
```
作業履歴を記録して（対象: code-developer）
```

---

## 作業終了トリガー

ユーザーから以下のような指示があった場合、**1日の作業終了**と判断する：
- 「本日はここまで」
- 「今日はここまで」
- 「作業終了」
- 「終わり」

### 終了時の対応

1. **作業履歴を記録**（work-history-recorder呼び出し）
2. **全体サマリーの最終行に要約を追記**
3. **TODO.md を更新**（各エージェントフォルダ）
4. **template-manager による変更検知**（エージェント定義の更新漏れチェック）

### 要約フォーマット

全体サマリー（`work/作業履歴/作業履歴_YYYYMMDD.md`）の最終行に以下を追記：

```markdown
---

## 本日の作業サマリー

### 実施内容
- （箇条書きで主要な作業を列挙）

### 成果物
- （作成・修正したファイル）

### 次回への申し送り
- （未完了タスク、注意事項）

### 作業時間
- 開始: HH:MM頃
- 終了: HH:MM頃
```

---

## 続きトリガー

ユーザーから以下のような指示があった場合、**前回作業の続き**と判断する：
- 「続きをお願い」
- 「続きから」
- 「前回の続き」

### 続き開始時の対応

1. **TODO.md を読み込む**（該当エージェントフォルダから）
2. **次回作業セクションを表示**
3. **最初のタスクを開始**（プランニング→ヒアリング→承認待ちのフローで）

### TODO.md の配置場所

| 対象 | パス |
|------|------|
| メインエージェント | `work/作業履歴/エージェント/TODO.md` |
| サブエージェント | `work/作業履歴/サブエージェント/{名前}/TODO.md` |

---

## TODO.md フォーマット

TODO.md は以下の2つの機能を兼用する：
1. **TODOリスト**: 作業中に発生したタスクをチェック形式で管理
2. **次回作業の引き継ぎ**: 「続きをお願い」で参照できる申し送り事項

### フォーマット

```markdown
# TODO管理

## 更新日: YYYY-MM-DD

---

## TODOリスト

### 高優先度
- [ ] タスク1
- [ ] タスク2

### 中優先度
- [ ] タスク3

### 低優先度
- [ ] タスク4

### 完了
- [x] 完了したタスク（YYYY-MM-DD完了）

---

## 次回作業（続きをお願い用）

### 前回の作業状況
- （前回完了した作業を記載）

### 次にやるべきこと
1. （最初に着手すべきタスク）
2. （次のタスク）

### 申し送り事項
- （注意点、留意事項）
```

### TODO.md の更新タイミング

| タイミング | 動作 |
|-----------|------|
| 作業終了時（「今日はここまで」等） | 未完了タスク + 次回作業を更新（上書き） |
| 作業中にTODO発生 | TODOリストに追記 |
| タスク完了時 | チェックを入れて「完了」セクションに移動 |

---

## MDファイル作成時のルール

MDファイルを作成・更新する際は、以下のルールに従うこと：

1. **配置場所**: `.claude/docs/` 配下の適切なフォルダに配置
2. **命名規則**: ケバブケース（例: `setup-guide.md`）
3. **重複禁止**: 同じ内容を複数ファイルに記載しない
4. **リンク参照**: 他の場所で必要な場合はリンクで参照

詳細は `doc-management` Skill を参照。

---

## 更新履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-10 | 初版作成（プロジェクトテンプレート用） |

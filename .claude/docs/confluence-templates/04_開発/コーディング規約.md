# コーディング規約

## 概要

本プロジェクトのコーディング規約を定義します。

---

## 基本原則

1. **可読性**: コードは書く時間より読む時間の方が長い。読みやすさを最優先する
2. **一貫性**: プロジェクト全体で統一されたスタイルを維持する
3. **シンプルさ**: 複雑さを避け、シンプルな実装を心がける
4. **自己文書化**: コード自体が意図を説明するよう命名・構造化する

---

## 命名規則

### 全般

| 対象 | 規則 | 例 |
|------|------|-----|
| 変数 | camelCase | `userName`, `isActive` |
| 定数 | UPPER_SNAKE_CASE | `MAX_RETRY_COUNT`, `API_URL` |
| 関数 | camelCase | `getUserById`, `calculateTotal` |
| クラス | PascalCase | `UserService`, `OrderController` |
| ファイル | kebab-case または PascalCase | `user-service.ts`, `UserService.ts` |
| ディレクトリ | kebab-case | `user-management`, `api-client` |

### 具体例

```typescript
// 良い例
const userName = 'John';
const isUserActive = true;
const MAX_LOGIN_ATTEMPTS = 5;

function getUserById(userId: number): User {
  // ...
}

class UserRepository {
  // ...
}

// 悪い例
const user_name = 'John';  // スネークケースは使わない
const active = true;       // 意味が曖昧
const max = 5;             // 定数は大文字で

function get(id: number) { // 何を取得するか不明
  // ...
}
```

### 命名のガイドライン

| パターン | 命名規則 | 例 |
|---------|---------|-----|
| Boolean変数 | is/has/can/should + 形容詞/過去分詞 | `isActive`, `hasPermission` |
| 配列 | 複数形 | `users`, `orderItems` |
| 関数（取得） | get/fetch/find + 名詞 | `getUser`, `findOrders` |
| 関数（作成） | create/add + 名詞 | `createUser`, `addItem` |
| 関数（更新） | update/set + 名詞 | `updateUser`, `setStatus` |
| 関数（削除） | delete/remove + 名詞 | `deleteUser`, `removeItem` |
| 関数（検証） | validate/check/is + 名詞 | `validateEmail`, `isValid` |

---

## フォーマット

### インデント・空白

| 項目 | 規則 |
|------|------|
| インデント | スペース2つ |
| 行末空白 | 禁止 |
| 最大行長 | 100文字 |
| ファイル末尾 | 改行1つ |

### 括弧・改行

```typescript
// 関数定義
function calculateTotal(items: Item[]): number {
  // 処理
}

// 条件分岐
if (condition) {
  // 処理
} else {
  // 処理
}

// オブジェクト
const user = {
  name: 'John',
  age: 30,
  email: 'john@example.com',
};

// 配列
const numbers = [1, 2, 3, 4, 5];

const longArray = [
  'item1',
  'item2',
  'item3',
];
```

---

## コメント

### 基本方針

- コードで表現できることはコメントにしない
- 「何をしているか」ではなく「なぜそうしているか」を書く
- TODOコメントには担当者と期限を記載

### コメント形式

```typescript
// 単一行コメント

/*
 * 複数行コメント
 * 長い説明が必要な場合
 */

/**
 * JSDoc形式（関数・クラスの説明）
 * @param userId - ユーザーID
 * @returns ユーザー情報
 */
function getUser(userId: number): User {
  // ...
}

// TODO(yamada): 2024-03-01までにリファクタリング
// FIXME: パフォーマンス改善が必要
// NOTE: 外部APIの仕様により必要
```

---

## ディレクトリ構成

```
src/
├── controllers/     # リクエストハンドリング
├── services/        # ビジネスロジック
├── repositories/    # データアクセス
├── models/          # データモデル
├── middlewares/     # ミドルウェア
├── utils/           # ユーティリティ関数
├── types/           # 型定義
├── constants/       # 定数
└── config/          # 設定
```

---

## エラーハンドリング

### 基本方針

```typescript
// カスタムエラークラスを使用
class ApplicationError extends Error {
  constructor(
    public code: string,
    message: string,
    public statusCode: number = 500
  ) {
    super(message);
    this.name = 'ApplicationError';
  }
}

// エラーを適切にハンドリング
async function getUser(id: number): Promise<User> {
  try {
    const user = await userRepository.findById(id);
    if (!user) {
      throw new ApplicationError('NOT_FOUND', 'ユーザーが見つかりません', 404);
    }
    return user;
  } catch (error) {
    if (error instanceof ApplicationError) {
      throw error;
    }
    throw new ApplicationError('INTERNAL_ERROR', '予期しないエラーが発生しました');
  }
}
```

---

## 禁止事項

### やってはいけないこと

| 禁止事項 | 理由 |
|---------|------|
| any型の使用 | 型安全性が失われる |
| console.log（本番コード） | ログライブラリを使用する |
| マジックナンバー | 定数として定義する |
| ネストの深いコード | 早期リターンで平坦化する |
| 巨大な関数 | 50行以内を目安に分割 |
| コメントアウトしたコード | Gitで管理するので削除 |

### コード例

```typescript
// 悪い例
function process(data: any) {  // any禁止
  if (data) {
    if (data.items) {
      if (data.items.length > 0) {  // ネスト深すぎ
        for (let i = 0; i < data.items.length; i++) {
          if (data.items[i].price > 1000) {  // マジックナンバー
            console.log(data.items[i]);  // console.log禁止
          }
        }
      }
    }
  }
}

// 良い例
const MINIMUM_PRICE = 1000;

function processItems(data: ItemData): void {
  if (!data?.items?.length) {
    return;  // 早期リターン
  }

  const expensiveItems = data.items.filter(
    item => item.price > MINIMUM_PRICE
  );

  logger.info('Expensive items:', expensiveItems);
}
```

---

## コードレビュー観点

| 観点 | チェック内容 |
|------|------------|
| 命名 | 意図が明確か、規約に沿っているか |
| 可読性 | 理解しやすいか、複雑すぎないか |
| テスト | テストが書かれているか、十分か |
| セキュリティ | 脆弱性がないか |
| パフォーマンス | 非効率な処理がないか |
| エラー処理 | 適切にハンドリングされているか |

---

**最終更新**: YYYY-MM-DD
**更新者**: {名前}
